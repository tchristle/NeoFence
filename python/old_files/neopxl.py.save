import socket
import time
#import matplotlib.pyplot as plt
import numpy as np
import select
from evdev import InputDevice, categorize, ecodes

import select
from evdev import InputDevice, categorize, ecodes

def np2ba(np):
    ba=bytearray()
    for i in np:
        for j in i:
            ba.append(chr(j))
    return ba

def rotL(arr):
    arr=arr[-3:]+arr[:-3]
    return arr
    
def blink():
    while 1:
        a=s.sendto(zba, ('192.168.1.24', UDP_PORT))
        time.sleep(0.1)
        a=s.sendto(bigba, ('192.168.1.24', UDP_PORT))
        time.sleep(0.1)
	
def on():
    s.sendto(bigba, ('192.168.1.24', UDP_PORT))

def off():
    a=s.sendto(zba, ('192.168.1.24', UDP_PORT))

def twirl(n):
    i=0
    while 1:
        a=s.sendto(bar[i:i+180], (UDP_IP, UDP_PORT))
        i=i+n
        if i > 765:
            i=-768
        time.sleep(0.100)

def fill(r, g, b):
    npa=[]
    for i in range(0,60):
        npa.append((r,g,b))
    a=s.sendto(np2ba(npa), (UDP_IP, UDP_PORT))

def rotfill(delay):
    color=0
    while 1:
        fill(nprs[color][0],nprs[color][1],nprs[color][2])
        time.sleep(delay)
        color=color+1
        if color == 256:
            color=0

def fade2red(delay):
    redba=bar[768-60:768]+bar[0:120]
    while 1:
        a=s.sendto(redba, ('192.168.1.24', UDP_PORT))
        time.sleep(delay)
        redba=rotL(redba)
        
def fade2(c1, c2, delay):
    cba=bar[768-c1:768]+bar[0:c2]
    while 1:
        a=s.sendto(cba, ('192.168.1.24', UDP_PORT))
        time.sleep(delay)
        cba=rotL(cba)

def fill2(color):
    fill(nprs[color][0],nprs[color][1],nprs[color][2])    

###---------------------------------------------------------------------###    

#ba = np2ba(arr)
#s.sendto(ba, (UDP_IP, UDP_PORT))

bigba=bytearray(180)
zba=bytearray(180)
for i in range(0,180):
	bigba[i]=chr(128)

c = np.arange(0,128)
ncosi = 64+64*np.cos(c*np.pi/127)
cosi = 64+64*np.cos(c*np.pi/127-np.pi)
high=np.ones(128)*128
low=np.zeros(128)
#plt.plot(c,cosi)
#plt.show()

UDP_IP = '192.168.1.24'
UDP_PORT = 5006
s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

npr=[]
r=g=b = 0
for i in range(0,128):
    r=128
    g=int(cosi[i])
    b=0
    npr.append((r,g,b))
    #print i, npr[i]
for i in range(128,256):
    r=int(ncosi[i-128])
    g=128
    b=0
    npr.append((r,g,b))
    #print i, npr[i]
for i in range(256,384):
    r=0
    g=128
    b=int(cosi[i-256])
    npr.append((r,g,b))
    #print i, npr[i]
for i in range(384,512):
    r=0
    g=int(ncosi[i-384])
    b=128
    npr.append((r,g,b))
    #print i, npr[i]
for i in range(512,640):
    r=int(cosi[i-512])
    g=0
    b=128
    npr.append((r,g,b))
    #print i, npr[i]
for i in range(640,768):
    r=128
    g=0
    b=int(ncosi[i-640])
    npr.append((r,g,b))
    #print i, npr[i]

nprs=[]
for x in range(0,768,3):
    nprs.append(npr[x])

bar = np2ba(nprs)

color=42
fill(nprs[color][0],nprs[color][1],nprs[color][2])
